<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>卜列仕電子看板</title>
    <!-- 引入 Google Fonts 讓中文字體更漂亮、更有現代感 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ================= 全局設定 ================= */
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #fff; 
            font-family: 'Noto Sans TC', "Microsoft JhengHei", sans-serif; 
            overflow: hidden; 
        }
        #container { display: flex; height: 100vh; width: 100vw; }
        
        /* ================= 左側側邊欄 (深灰質感) ================= */
        #sidebar { 
            width: 28%; /* 稍微縮窄，留更多空間給內容 */
            background: linear-gradient(180deg, #1f1f1f 0%, #121212 100%); /* 漸層背景 */
            padding: 30px; 
            box-sizing: border-box; 
            border-right: 1px solid #333; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 10px 0 30px rgba(0,0,0,0.8);
            z-index: 10;
        }

        /* --- Logo 區域 --- */
        #logo-container {
            background-color: #fff; /* 白底，適配您的Logo */
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        #logo-container img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        /* --- 時鐘區域 --- */
        #clock { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; /* 數字用英文字體比較整齊 */
            font-size: 32px; 
            font-weight: 300; 
            color: #888; 
            margin-bottom: 30px; 
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
            line-height: 1.4;
        }
        #clock strong { color: #fff; font-weight: 600; font-size: 36px; } /* 時間部分加亮 */

        /* --- 公告列表 --- */
        #list-container { flex-grow: 1; overflow-y: auto; }
        
        /* 列表項目樣式 */
        .list-item { 
            margin-bottom: 15px; 
            padding: 15px 20px;
            border-radius: 8px;
            transition: all 0.4s ease; 
            opacity: 0.6; 
            border-left: 4px solid transparent;
        }
        .list-item h3 { margin: 0; font-size: 22px; font-weight: 500; letter-spacing: 1px; }

        /* 作用中的項目 (發光效果) */
        .list-item.active { 
            background: rgba(255, 204, 0, 0.1); /* 淡黃色背景 */
            color: #ffcc00; 
            opacity: 1; 
            border-left: 4px solid #ffcc00; 
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* ================= 右側主畫面 ================= */
        #main { 
            width: 72%; 
            display: flex; 
            flex-direction: column; 
            background: #000;
        }

        /* 圖片區 */
        #main img { 
            width: 100%; 
            flex-grow: 1;      
            height: 0;         
            object-fit: contain; 
            background-color: #000; 
        }

        /* 文字說明區 */
        #overlay { 
            position: relative; 
            width: 100%; 
            background: #181818;   
            padding: 35px 50px; 
            box-sizing: border-box;
            border-top: 4px solid #ffcc00; /* 頂部黃條呼應企業色 */
            min-height: 220px; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }
        
        h1 { 
            font-size: 48px; 
            margin: 0 0 15px 0; 
            color: #fff; 
            font-weight: 700;
        }
        p { 
            font-size: 26px; 
            line-height: 1.6; 
            color: #ccc; 
            white-space: pre-wrap; 
            margin: 0; 
        }

    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        <!-- Logo 區塊 -->
        <div id="logo-container">
            <!-- 請確保檔名上傳正確，如果您上傳的是 png，請把 .jpg 改成 .png -->
            <img src="https://arno-su.github.io/tv-signage/logo.jpg" alt="PULIX Logo">
        </div>

        <div id="clock">Loading...</div>
        <div id="list-container">
            <!-- 公告列表 -->
        </div>
    </div>
    <div id="main">
        <img id="main-img" src="" alt="">
        <div id="overlay">
            <h1 id="main-title">載入中...</h1>
            <p id="main-content">正在連線至自動化系統...</p>
        </div>
    </div>
</div>

<script>
    const API_URL = 'https://arnon8n.zeabur.app/webhook/signage-data';
    
    let currentIndex = 0;
    let announcements = [];

    // 時鐘功能 (優化顯示格式)
    function updateClock() {
        const now = new Date();
        const dateStr = now.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
        // 時間部分用 <strong> 包起來，方便 CSS 單獨設定樣式
        const timeStr = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit' });
        
        document.getElementById('clock').innerHTML = dateStr + '<br><strong>' + timeStr + '</strong>';
    }
    setInterval(updateClock, 1000);
    updateClock(); 

    // 抓取資料
    async function fetchData() {
        try {
            console.log("連線 n8n...");
            const res = await fetch(API_URL);
            const json = await res.json();
            
            if (json.data) {
                if (Array.isArray(json.data)) {
                    announcements = json.data;
                } else if (typeof json.data === 'string') {
                    try {
                        announcements = JSON.parse(json.data);
                    } catch (e) { announcements = []; }
                }
            } else if (Array.isArray(json)) {
                announcements = json;
            }

            if (announcements.length > 0) {
                updateScreen();
            } else {
                document.getElementById('main-title').innerText = "目前無公告";
                document.getElementById('main-content').innerText = "";
            }

        } catch (e) {
            console.error(e);
            document.getElementById('main-title').innerText = "連線等待中";
        }
    }

    // 更新畫面
    function updateScreen() {
        if (!Array.isArray(announcements) || announcements.length === 0) return;
        if (currentIndex >= announcements.length) currentIndex = 0;
        
        const item = announcements[currentIndex];
        
        const title = item['標題'] || item.title || "無標題";
        const content = item['內容'] || item.content || "";
        const imgLink = item['圖片連結'] || item.image || "";
        
        document.getElementById('main-title').innerText = title;
        document.getElementById('main-content').innerText = content;
        
        const placeholder = 'https://via.placeholder.com/1920x1080/333333/ffcc00?text=PULIX+News';
        document.getElementById('main-img').src = imgLink ? imgLink : placeholder;

        let listHtml = "";
        announcements.forEach((ann, idx) => {
            const annTitle = ann['標題'] || ann.title || "無標題";
            const activeClass = (idx === currentIndex) ? "active" : "inactive";
            listHtml += `<div class="list-item ${activeClass}">
                            <h3>${annTitle}</h3>
                         </div>`;
        });
        document.getElementById('list-container').innerHTML = listHtml;

        currentIndex++;
    }

    fetchData(); 
    setInterval(updateScreen, 10000); 
    setInterval(fetchData, 300000);   

</script>

</body>
</html>